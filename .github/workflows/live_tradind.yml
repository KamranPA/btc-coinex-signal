name: ๐ ุงุฌุฑุง ุณุณุชู ูุนุงููุงุช ุฒูุฏู

on:
  # ุงุฌุฑุง ุฎูุฏฺฉุงุฑ ูุฑ 15 ุฏููู ุงุฒ ุณุงุนุช 03:00 ุชุง 20:30 UTC (06:30 ุชุง 23:30 ุจู ููุช ุงุฑุงู)
  schedule:
    - cron: '*/15 3-20 * * *'

  # ุงูฺฉุงู ุงุฌุฑุง ุฏุณุช ุงุฒ ุทุฑู GitHub Actions
  workflow_dispatch:
    inputs:
      force_run:
        description: 'ุงุฌุฑุง ุฎุงุฑุฌ ุงุฒ ุณุงุนุงุช ุจุงุฒุงุฑุ'
        type: boolean
        default: false
        required: false

jobs:
  run-trading:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
    # 1๏ธโฃ ุฏุฑุงูุช ฺฉุฏ ุงุฒ ุฑูพุงุฒุชูุฑ
    - name: ๐ ุฏุฑุงูุช ฺฉุฏ (Checkout)
      uses: actions/checkout@v4

    # 2๏ธโฃ ุชูุธู ูพุงุชูู 3.9
    - name: ๐ ุชูุธู ูพุงุชูู 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3๏ธโฃ ูุตุจ ฺฉุชุงุจุฎุงููโูุง ูพุงุชูู
    - name: ๐ฆ ูุตุจ ฺฉุชุงุจุฎุงููโูุง ูพุงุชูู
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4๏ธโฃ ุงุฌุงุฏ ูพูุดูโูุง ุถุฑูุฑ
    - name: ๐ ุงุฌุงุฏ ูพูุดูโูุง ูุงฺฏ ู ูุชุงุฌ
      run: |
        mkdir -p logs results src/logs src/results

    # 5๏ธโฃ ุงุฌุฑุง ุณุณุชู ูุนุงููุงุช ุจุง ุชูุธู PYTHONPATH
    - name: โถ๏ธ ุงุฌุฑุง ุณุณุชู ูุนุงููุงุช (ุญุงูุช ุฒูุฏู)
      run: |
        # ุชูุธู PYTHONPATH ุจุฑุง ุฏุณุชุฑุณ ุจู ูุงฺููโูุง ุฏุงุฎู src/
        export PYTHONPATH="${PYTHONPATH}:${{ github.workspace }}/src"
        cd src && python main.py --mode live

    # 6๏ธโฃ ุขูพููุฏ ูุงฺฏโูุง ุจุฑุง ุฏุจุงฺฏ (ุฏุฑ ูุฑ ุตูุฑุช)
    - name: ๐ ุขูพููุฏ ูุงฺฏโูุง
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: trading-logs
        path: logs/
        retention-days: 3
