name: ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ Ø²Ù†Ø¯Ù‡

on:
  # Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ø± 15 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø² Ø³Ø§Ø¹Øª 03:00 ØªØ§ 20:30 UTC
  schedule:
    - cron: '*/15 3-20 * * *'
  
  # Ø§Ù…Ú©Ø§Ù† Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø³ØªÛŒ
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Ø§Ø¬Ø±Ø§ Ø®Ø§Ø±Ø¬ Ø§Ø² Ø³Ø§Ø¹Ø§Øª Ø¨Ø§Ø²Ø§Ø±ØŸ'
        type: boolean
        default: false
        required: false

jobs:
  run-trading:
    runs-on: ubuntu-latest
    env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
    - name: ğŸ” Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ (Checkout)
      uses: actions/checkout@v4

    - name: ğŸ ØªÙ†Ø¸ÛŒÙ… Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: âš™ï¸ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…ÛŒ
      run: |
        sudo apt-get update -y
        sudo apt-get install -y build-essential libssl-dev libffi-dev python3-dev
        # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ù†ØµØ¨ TA-Lib (Ø¨Ø±Ø§ÛŒ TA-Lib==0.4.24)
        wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz
        tar -xzf ta-lib-0.4.0-src.tar.gz
        cd ta-lib && ./configure --prefix=/usr && make && sudo make install
        sudo ldconfig  # Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§

    - name: ğŸ“¦ Ù†ØµØ¨ Ø¨Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØªÙˆÙ†
      run: |
        python -m pip install --upgrade pip
        pip install wheel
        pip install -r requirements.txt

    - name: ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
      run: |
        mkdir -p logs
        mkdir -p results
        mkdir -p src/logs
        mkdir -p src/results

    - name: â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ù…Ø¹Ø§Ù…Ù„Ø§ØªÛŒ
      run: |
        cd src && python main.py --mode live

    - name: ğŸ“ Ø¢Ù¾Ù„ÙˆØ¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ (Ø¯Ø± Ù‡Ø± ØµÙˆØ±Øª)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: trading-logs
        path: logs/
        retention-days: 3
