name: ğŸ“Š Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ú©â€ŒØªØ³Øª ØªØ§Ø±ÛŒØ®ÛŒ

on:
  workflow_dispatch:
    inputs:
      start_date:
        description: 'ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ (YYYY-MM-DD)'
        type: string
        default: '2023-01-01'
        required: true
      end_date:
        description: 'ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† (YYYY-MM-DD)'
        type: string
        default: '2023-12-31'
        required: true

jobs:
  backtest:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    env:
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
    - name: ğŸ” Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯
      uses: actions/checkout@v4

    - name: ğŸ ØªÙ†Ø¸ÛŒÙ… Ù¾Ø§ÛŒØªÙˆÙ† 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: ğŸ“¦ Ù†ØµØ¨ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
      run: |
        mkdir -p logs
        mkdir -p results
        mkdir -p src/logs
        mkdir -p src/results

    - name: â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ú©â€ŒØªØ³Øª
      run: |
        cd src && python main.py \
          --mode backtest \
          --start ${{ inputs.start_date }} \
          --end ${{ inputs.end_date }}

    - name: ğŸ“ Ø¢Ù¾Ù„ÙˆØ¯ Ù†ØªØ§ÛŒØ¬ Ø¨Ú©â€ŒØªØ³Øª
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: backtest-results
        path: results/
        retention-days: 7

    - name: ğŸ“ Ø¢Ù¾Ù„ÙˆØ¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: backtest-logs
        path: logs/
        retention-days: 7
