name: ๐ ุชุณุช ุฑูุน ูุดฺฉู TA-Lib

on:
  workflow_dispatch:  # ููุท ุจุง ฺฉูฺฉ ุฏุณุช ุงุฌุฑุง ุดูุฏ
  push:
    branches: [ main, master ]

jobs:
  test-talib:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
    - name: ๐งฐ ุฏุฑุงูุช ฺฉุฏ (Checkout)
      uses: actions/checkout@v4

    - name: ๐ ุชูุธู Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: ๐ฆ ุจูโุฑูุฒุฑุณุงู ุณุณุชู ู ูุตุจ ูพุดโูุงุฒูุง
      run: |
        sudo apt-get update -y
        sudo apt-get install -y \
          build-essential \
          libssl-dev \
          libffi-dev \
          python3-dev \
          wget \
          libtool \
          automake \
          g++ \
          make \
          git

    - name: ๐ฅ ุฏุงูููุฏ TA-Lib ุงุฒ ุณูุฑุณ
      run: |
        wget https://downloads.sourceforge.net/project/ta-lib/ta-lib/0.4.0/ta-lib-0.4.0-src.tar.gz
        tar -xzf ta-lib-0.4.0-src.tar.gz
        cd ta-lib && ls -la

    - name: โ๏ธ ูพฺฉุฑุจูุฏ TA-Lib
      run: |
        cd ta-lib
        ./configure --prefix=/usr

    - name: ๐จ ฺฉุงููพุงู TA-Lib (make)
      run: |
        cd ta-lib
        make -j$(nproc)

    - name: ๐งฉ ูุตุจ TA-Lib ุฏุฑ ุณุณุชู
      run: |
        cd ta-lib
        sudo make install
        sudo ldconfig  # ุจุงุฑฺฏุฐุงุฑ ฺฉุชุงุจุฎุงููโูุง

    - name: โ ุจุฑุฑุณ ูุตุจ ูุฒฺฉ ฺฉุชุงุจุฎุงูู
      run: |
        echo "๐ ุจุฑุฑุณ ูุฌูุฏ ฺฉุชุงุจุฎุงูู ุฏุฑ ุณุณุชู..."
        ls -la /usr/lib | grep -i ta_lib
        find /usr/lib -name "*ta_lib*" 2>/dev/null || echo "ฺฉุชุงุจุฎุงูู ุงูุช ูุดุฏ."

    - name: ๐ ูุตุจ pip ู wheel
      run: |
        python -m pip install --upgrade pip
        pip install wheel

    - name: ๐ฆ ูุตุจ TA-Lib ุงุฒ PyPI (ูุณุฎู ูพุงุชูู)
      run: |
        pip install TA-Lib==0.4.24

    - name: ๐งช ุชุณุช ูุงุฑุฏ ฺฉุฑุฏู ูุงฺูู talib
      run: |
        python -c "
        try:
            import talib
            print(f'๐ ูููู! TA-Lib ูุงุฑุฏ ุดุฏ. ูุณุฎู: {talib.__version__}')
            print('๐ ูุงู ูุงฺูู:', talib.__name__)
        except ImportError as e:
            print(f'โ ุฎุทุง ุฏุฑ ูุงุฑุฏ ฺฉุฑุฏู talib: {e}')
            exit(1)
        except Exception as e:
            print(f'โ๏ธ ุฎุทุง ูุงุดูุงุฎุชู: {e}')
            exit(1)
        "

    - name: ๐ ููุงุด ุงุทูุงุนุงุช ุณุณุชู (ุจุฑุง ุฏุจุงฺฏ)
      if: always()
      run: |
        echo "๐ ุงุทูุงุนุงุช ุณุณุชู:"
        uname -a
        python --version
        pip list | grep -i talib
        echo "๐ ูุณุฑูุง ฺฉุชุงุจุฎุงูู:"
        ldconfig -p | grep -i ta_lib
