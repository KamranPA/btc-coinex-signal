# .github/workflows/backtest.yml
name: 📊 بک‌تست دستی با انتخاب تاریخ

on:
  workflow_dispatch:
    inputs:
      start_date:
        description: 'تاریخ شروع (فرمت: YYYY-MM-DD)'
        required: true
        default: '2025-04-01'
      end_date:
        description: 'تاریخ پایان (فرمت: YYYY-MM-DD)'
        required: true
        default: '2025-05-01'

jobs:
  backtest:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout کد
        uses: actions/checkout@v3

      - name: نصب پایتون 3.11
        uses: actions/setup-python@v4
        with:
          python-version: 3.10

      - name: نصب کتابخانه‌ها
        run: |
          pip install ccxt pandas requests

      - name: جایگزینی تاریخ در backtest.py
        run: |
          echo "📅 تنظیم بازه زمانی: ${{ github.event.inputs.start_date }} تا ${{ github.event.inputs.end_date }}"
          sed -i "s|START_DATE = '.*'|START_DATE = '${{ github.event.inputs.start_date }}'|g" backtest.py
          sed -i "s|END_DATE = '.*'|END_DATE = '${{ github.event.inputs.end_date }}'|g" backtest.py

      - name: اجرای بک‌تست
        run: python backtest.py
