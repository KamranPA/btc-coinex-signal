# .github/workflows/backtest.yml
name: 📊 بک‌تست استراتژی (قابل تنظیم)

on:
  workflow_dispatch:
    inputs:
      symbol:
        description: 'نماد برای بک‌تست (مثال: BTC/USDT)'
        required: true
        default: 'BTC/USDT'
      start_date:
        description: 'تاریخ شروع (فرمت: YYYY-MM-DD)'
        required: true
        default: '2024-01-01'
      end_date:
        description: 'تاریخ پایان (فرمت: YYYY-MM-DD)'
        required: true
        default: '2024-06-01'
      timeframe:
        description: 'تایم‌فریم (مثال: 15m, 1h)'
        required: true
        default: '15m'

jobs:
  run-backtest:
    runs-on: ubuntu-latest
    env:
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      CHAT_ID: ${{ secrets.CHAT_ID }}

    steps:
      - name: 🔽 کلون کردن ریپوزیتوری
        uses: actions/checkout@v4

      - name: 🐍 نصب پایتون
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: 📦 نصب وابستگی‌ها
        run: |
          pip install -r requirements.txt

      - name: 📁 ایجاد پوشه results
        run: mkdir -p results

      - name: ▶️ اجرای بک‌تست با ورودی‌ها
        run: |
          python backtest.py \
            --symbol "${{ github.event.inputs.symbol }}" \
            --start "${{ github.event.inputs.start_date }}" \
            --end "${{ github.event.inputs.end_date }}" \
            --timeframe "${{ github.event.inputs.timeframe }}"

      - name: 📤 آپلود نتایج بک‌تست
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: backtest-results
          path: results/
