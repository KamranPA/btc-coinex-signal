# .github/workflows/backtest.yml
name: ğŸ“Š Ø¨Ú©â€ŒØªØ³Øª Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ (Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…)

on:
  workflow_dispatch:
    inputs:
      symbol:
        description: 'Ù†Ù…Ø§Ø¯ Ø¨Ø±Ø§ÛŒ Ø¨Ú©â€ŒØªØ³Øª (Ù…Ø«Ø§Ù„: BTC/USDT)'
        required: true
        default: 'BTC/USDT'
      start_date:
        description: 'ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ (ÙØ±Ù…Øª: YYYY-MM-DD)'
        required: true
        default: '2024-01-01'
      end_date:
        description: 'ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† (ÙØ±Ù…Øª: YYYY-MM-DD)'
        required: true
        default: '2024-06-01'
      timeframe:
        description: 'ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ… (Ù…Ø«Ø§Ù„: 15m, 1h)'
        required: true
        default: '15m'

jobs:
  run-backtest:
    runs-on: ubuntu-latest
    env:
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
      CHAT_ID: ${{ secrets.CHAT_ID }}

    steps:
      - name: ğŸ”½ Ú©Ù„ÙˆÙ† Ú©Ø±Ø¯Ù† Ø±ÛŒÙ¾ÙˆØ²ÛŒØªÙˆØ±ÛŒ
        uses: actions/checkout@v4

      - name: ğŸ Ù†ØµØ¨ Ù¾Ø§ÛŒØªÙˆÙ†
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: ğŸ“¦ Ù†ØµØ¨ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
        run: |
          pip install -r requirements.txt

      - name: ğŸ“ Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ results
        run: mkdir -p results

      - name: â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ú©â€ŒØªØ³Øª Ø¨Ø§ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
        run: |
          python backtest.py \
            --symbol "${{ github.event.inputs.symbol }}" \
            --start "${{ github.event.inputs.start_date }}" \
            --end "${{ github.event.inputs.end_date }}" \
            --timeframe "${{ github.event.inputs.timeframe }}"

      - name: ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ Ù†ØªØ§ÛŒØ¬ Ø¨Ú©â€ŒØªØ³Øª
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: backtest-results
          path: results/
